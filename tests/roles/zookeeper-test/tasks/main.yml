---
- name: Download and install netcat (yum)
  yum: name={{ item }} state=installed
  with_items:
    - nc
  when: ansible_os_family == "RedHat"

- name: Download and install netcat (apt)
  apt: name={{ item }} state=installed
  with_items: netcat
  when: ansible_os_family == "Debian"

- name: Send ruok to Zookeeper
  shell: echo ruok | nc 127.0.0.1 2181
  register: zoo_ruok_status

- name: Fail if zookeeper status not imok
  fail: msg="Zookeeper not OK"
  when: zoo_ruok_status.stdout != "imok"

- name: Send stat to Zookeeper
  shell: echo stat | nc 127.0.0.1 2181
  register: zoo_stat_status

- name: Fail if zookeeper mode isn't leader, follower or standalone
  fail: msg="Zookeeper not Failed"
  when: "'Mode: leader' not in zoo_stat_status.stdout and 'Mode: follower' not in zoo_stat_status.stdout and 'Mode: standalone' not in zoo_stat_status.stdout"
